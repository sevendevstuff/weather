<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CRUD Template</title>
    <style>
        /* Basic styling for demonstration */
        .container {
            width: 80%;
            margin: 20px auto;
        }

        .data-list {
            list-style: none;
            padding: 0;
        }

        .data-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-item div {
            flex-grow: 1;
        }

        /* Popup styles */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid #ccc;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>My CRUD Page</h1>

    <button id="add-button">+</button>

    <ul class="data-list" th:each="item : ${dataList}">
        <li class="data-item">
            <div th:text="${item}"></div>
            <button class="edit-button">Edit</button>
            <button class="delete-button">Delete</button>
        </li>
    </ul>

    <div id="add-popup" class="popup">
        <h2>Add New Data</h2>
        <form id="add-form">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name"><br><br>

            <label for="fabricationYear">Fabrication Year:</label>
            <input type="number" id="fabricationYear" name="fabricationYear"><br><br>

            <label for="doorNumber">Number of Doors:</label>
            <input type="number" id="doorNumber" name="doorNumber"><br><br>

            <button type="submit">Add</button>
            <button type="button" onclick="closePopup()">Close</button>
        </form>
    </div>

    <div id="edit-popup" class="popup">
        <h2>Edit Data</h2>
        <form id="edit-form">
            <input type="hidden" id="edit-id" name="id">
            <label for="edit-name">Name:</label>
            <input type="text" id="edit-name" name="name"><br><br>

            <label for="edit-fabricationYear">Fabrication Year:</label>
            <input type="number" id="edit-fabricationYear" name="fabricationYear"><br><br>

            <label for="edit-doorNumber">Number of Doors:</label>
            <input type="number" id="edit-doorNumber" name="doorNumber"><br><br>

            <button type="submit">Save</button>
            <button type="button" onclick="closePopup()">Close</button>
        </form>
    </div>
</div>

<script>
    // Add new car functionality
    document.getElementById('add-button').addEventListener('click', () => {
        document.getElementById('add-popup').style.display = 'block';
    });

    function closePopup() {
        document.getElementById('add-popup').style.display = 'none';
        document.getElementById('edit-popup').style.display = 'none';
    }

    document.querySelector('#add-popup form').addEventListener('submit', (event) => {
        event.preventDefault(); // Prevent default form submission

        const formData = new FormData(event.target);
        const plainFormData = Object.fromEntries(formData.entries());
        const jsonData = JSON.stringify(plainFormData);

        fetch('/cars', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            closePopup();
            location.reload();
        })
        .catch(error => {
            console.error('Error during POST request:', error);
        });
    });

    // Edit functionality
    document.querySelectorAll('.edit-button').forEach((button, index) => {
        button.addEventListener('click', () => {
            const item = document.querySelectorAll('.data-item')[index];
            const carData = item.querySelector('div').getAttribute('th:text'); // Assuming it's a JSON object

            console.log(item, carData);

            // Populate the edit form
            document.getElementById('edit-id').value = carData.id;
            document.getElementById('edit-name').value = carData.name;
            document.getElementById('edit-fabricationYear').value = carData.fabricationYear;
            document.getElementById('edit-doorNumber').value = carData.doorNumber;

            document.getElementById('edit-popup').style.display = 'block';
        });
    });

    document.querySelector('#edit-popup form').addEventListener('submit', (event) => {
        event.preventDefault();

        const formData = new FormData(event.target);
        const plainFormData = Object.fromEntries(formData.entries());
        const jsonData = JSON.stringify(plainFormData);

        fetch('/cars/' + plainFormData.id, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            closePopup();
            location.reload();
        })
        .catch(error => {
            console.error('Error during PUT request:', error);
        });
    });

    // Delete functionality
    document.querySelectorAll('.delete-button').forEach((button, index) => {
        button.addEventListener('click', () => {
            const item = document.querySelectorAll('.data-item')[index];
            const carData = JSON.parse(item.querySelector('div').getAttribute('th:text')); // Assuming it's a JSON object

            if (confirm(`Are you sure you want to delete ${carData.name}?`)) {
                fetch('/cars/' + carData.id, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    location.reload();
                })
                .catch(error => {
                    console.error('Error during DELETE request:', error);
                });
            }
        });
    });
</script>

</body>
</html>